<% summary = ProjectSummary.new(projects) %>

<table class="projects-list">
  <thead>
    <tr>
      <th colspan=2 style="text-align:left"><%= l(:field_name) %></th>
      <th><%= l(:label_user_plural) %></th>
      <th><%= l(:label_issue_plural) %></th>
      <th><%= l(:label_activity) %></th>
    </tr>
  </thead>
  <tbody>
<% project_tree(projects) do |project, level| %>
  <% css_classes = "#{cycle "even", "odd"} #{project.css_classes} #{level > 0 ? "idnt idnt-#{level}" : nil}" %>
  <tr class="<%= css_classes %>">
    <td class=name>
      <div class=contextual>
        <span class=more>[<%= l(:label_more) %>]</span>
      </div>
      <span class="project-name">
        <%= link_to_project(project, {:action => (project.active? ? 'settings' : 'show')}, :title => project.short_description) %>
      </span>
    </td>
    <td class=membership>
      <% if User.current.member_of?(project) %>
        <span class="am-i-member member"><%= l(:member) %></span>
      <% else %>
        <span class="am-i-member not-member"><%= l(:not_member) %></span>
      <% end %>
    </td>
    <td class=users>
      <%= summary.users_count[project.id].to_i %>
    </td>
    <td class=issues>
      <%= summary.issues_open_count[project.id].to_i %> / <%= summary.issues_closed_count[project.id].to_i %>
    </td>
    <td class=activity>
      <span class=barchart><%= summary.activity_statistics[project.id].join(",") %></span>
    </td>
  </tr>
  <tr class="<%= css_classes %> project-more">
    <td class="project-summary name" colspan=5>
      <div class=project-description>
        <%= textilizable project.description %>
      </div>
    </td>
  </tr>
<% end %>
  </tbody>
</table>
